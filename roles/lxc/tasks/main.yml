---

- name: Upgrade to latest Debian
  include: debian.yml
  when: ansible_distribution == "Debian" and not ansible_distribution_major_version == "9"

- name: Install debootstrap
  apt:
    name: debootstrap

#- name: Install qemu
#  apt:
#    name: qemu

#- name: Install qemu-user-static
#  apt:
#    name: qemu-user-static

#- name: Install binfmt-support
#  apt:
#    name: binfmt-support

- name: Install lxc
  apt:
    name: lxc

- name: Touch container directory
  file: path=/var/lib/lxc/container state=directory

- name: Transfer container system
  copy: src=../rootfs dest=/var/lib/lxc/container/

- name: Run debootstrap second stage
  command: chroot /var/lib/lxc/container/rootfs /debootstrap/debootstrap --second-stage

- name: Configure the container, include settings for bridge
  blockinfile:
    dest: /var/lib/lxc/container/config
    block: |
      lxc.utsname = container
      lxc.rootfs = /var/lib/lxc/container/rootfs
      lxc.network.type = veth
      lxc.network.flags = up
      lxc.network.link = lxc-nat-bridge
      lxc.network.name = wlan0
      lxc.network.ipv4 = 192.168.30.2
      lxc.network.ipv4.gateway = 192.168.30.1

- name: Set up network bridge for container
  include: bridge.yml



#- name: Set password


#- name: Start lxc on boot
